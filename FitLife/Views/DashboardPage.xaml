<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="FitLife.Views.DashboardPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:models="clr-namespace:FitLife.Models"
    Title="Dashboard"
    Padding="16">

    <ContentPage.Resources>

        <!-- Title text style -->
        <Style x:Key="PageTitle" TargetType="Label">
            <Setter Property="FontSize" Value="36" />
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="HorizontalTextAlignment" Value="Center" />
            <Setter Property="Margin" Value="0,0,0,12" />
            <Setter Property="TextColor">
                <Setter.Value>
                    <AppThemeBinding Light="{StaticResource PrimaryColor}"
                                     Dark="{StaticResource AccentColor}" />
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Header style for sections -->
        <Style x:Key="SectionHeader" TargetType="Label" BasedOn="{StaticResource H2}">
            <Setter Property="TextColor" Value="{StaticResource PrimaryColor}" />
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="Margin" Value="0,16,0,4" />
        </Style>

        <!-- Numbers styling -->
        <Style x:Key="StatValue" TargetType="Label">
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="FontSize" Value="22" />
            <Setter Property="TextColor" Value="{StaticResource AccentColor}" />
        </Style>

        <!-- Horizontal workout cards -->
        <Style x:Key="SmallCard" TargetType="Frame" BasedOn="{StaticResource Card}">
            <Setter Property="Padding" Value="12" />
            <Setter Property="WidthRequest" Value="260" />
            <Setter Property="HeightRequest" Value="130" />
            <Setter Property="HasShadow" Value="True" />
            <Setter Property="CornerRadius" Value="16" />
            <!-- margin left-right handled by ItemSpacing, so only top/bottom -->
            <Setter Property="Margin" Value="0,4,0,4" />
            <Setter Property="BackgroundColor" Value="White" />
        </Style>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Spacing="18">

            <!-- App title -->
            <Label Text="FitLife" Style="{StaticResource PageTitle}" />

            <!-- Stats box -->
            <Frame Style="{StaticResource Card}">
                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">

                    <!-- Calories block -->
                    <VerticalStackLayout Spacing="4">
                        <Label Text="Calories today" Style="{StaticResource Caption}" />
                        <Label Text="{Binding CaloriesToday, FallbackValue=0, TargetNullValue=0}"
                               Style="{StaticResource StatValue}" />
                    </VerticalStackLayout>

                    <!-- Minutes block -->
                    <VerticalStackLayout Grid.Column="1"
                                         Spacing="4"
                                         HorizontalOptions="End">
                        <Label Text="Minutes this week"
                               Style="{StaticResource Caption}"
                               HorizontalOptions="End" />
                        <Label Text="{Binding MinutesThisWeek, FallbackValue=0, TargetNullValue=0}"
                               Style="{StaticResource StatValue}"
                               HorizontalOptions="End" />
                    </VerticalStackLayout>

                </Grid>
            </Frame>

            <!-- Workouts section title -->
            <Label Text="Workouts" Style="{StaticResource SectionHeader}" />

            <!-- Divider line -->
            <BoxView HeightRequest="1"
                     Color="{StaticResource BorderColor}"
                     Opacity="0.4" />

            <!-- HORIZONTAL list of workouts -->
            <CollectionView ItemsSource="{Binding TodayWorkouts}"
                            SelectionMode="None"
                            HeightRequest="150"
                            Margin="0,8,0,8">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Horizontal"
                                       ItemSpacing="16" />
                </CollectionView.ItemsLayout>

                <CollectionView.ItemTemplate>
                    <DataTemplate>

                        <!-- Workout card -->
                        <Frame Style="{StaticResource SmallCard}">
                            <VerticalStackLayout Spacing="4">

                                <!-- Workout title -->
                                <Label Text="{Binding Title}"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       TextColor="DarkCyan" />

                                <!-- Workout category -->
                                <Label Text="{Binding Category}"
                                       FontSize="14"
                                       TextColor="{StaticResource TextLight}" 
                                       FontAttributes="Bold"/>

                                <!-- Duration and calories -->
                                <HorizontalStackLayout Spacing="8">
                                    <Label Text="{Binding DurationMins, StringFormat='{}{0} min'}"
                                           TextColor="{StaticResource TextLight}" 
                                           FontAttributes="Bold"/>
                                    <Label Text="•"
                                           TextColor="{StaticResource TextLight}" />
                                    <Label Text="{Binding Calories, StringFormat='{}{0} kcal'}"
                                           TextColor="{StaticResource TextLight}" 
                                           FontAttributes="Bold"/>
                                </HorizontalStackLayout>

                                <!-- Workout level -->
                                <Label Text="{Binding Level}"
                                       FontSize="12"
                                       TextColor="{StaticResource AccentColor}" 
                                       FontAttributes="Bold"/>

                            </VerticalStackLayout>
                        </Frame>

                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Navigation buttons -->
            <Button Text="Workouts"
                    Style="{StaticResource PrimaryButton}"
                    Margin="0,4,0,8"
                    Command="{Binding GoToWorkoutsCommand}" />

            <Button Text="See Progress"
                    Style="{StaticResource PrimaryButton}"
                    Margin="0,0,0,12"
                    Command="{Binding GoToProgressCommand}" />

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
