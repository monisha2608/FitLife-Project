<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="FitLife.Views.ProgressChartPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:FitLife.ViewModels"
    xmlns:models="clr-namespace:FitLife.Models"
    x:DataType="vm:ProgressViewModel"
    Title="Progress"
    Padding="20">

    <ScrollView>
        <VerticalStackLayout Spacing="20"
                             HorizontalOptions="FillAndExpand">

            <!-- Page title -->
            <Label Text="Weekly Activity"
                   FontSize="30"
                   FontAttributes="Bold"
                   TextColor="{StaticResource PrimaryColor}"
                   HorizontalOptions="Center" />

            <!-- Progress summary card (FULL WIDTH) -->
            <Frame Style="{StaticResource Card}"
                   HorizontalOptions="FillAndExpand">

                <Grid ColumnDefinitions="*,Auto"
                      ColumnSpacing="20"
                      HorizontalOptions="FillAndExpand">

                    <!-- Left: title + bar -->
                    <VerticalStackLayout Spacing="10"
                                         HorizontalOptions="FillAndExpand">
                        <Label Text="Weekly Minutes vs Goal"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="{StaticResource TextDark}" />

                        <ProgressBar Progress="{Binding ProgressRatio}"
                                     HeightRequest="14"
                                     HorizontalOptions="FillAndExpand"
                                     ProgressColor="{StaticResource AccentColor}" />
                    </VerticalStackLayout>

                    <!-- Right: Numbers -->
                    <VerticalStackLayout Spacing="12"
                                         HorizontalOptions="End"
                                         VerticalOptions="Center">
                        <Label Text="{Binding MinutesSum, StringFormat='Done: {0} min'}"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="{StaticResource TextDark}" />

                        <Label Text="{Binding WeeklyGoalMinutes, StringFormat='Goal: {0} min'}"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="{StaticResource TextDark}" />
                    </VerticalStackLayout>

                </Grid>
            </Frame>

            <!-- Weekly bar chart (FULL WIDTH) -->
            <Frame Style="{StaticResource Card}"
                   HorizontalOptions="FillAndExpand">

                <CollectionView
                    ItemsSource="{Binding Weekly}"
                    SelectionMode="None"
                    HorizontalOptions="FillAndExpand"
                    HeightRequest="280">

                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout Orientation="Horizontal"
                                           ItemSpacing="80" />
                    </CollectionView.ItemsLayout>

                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:ProgressDay">
                            <VerticalStackLayout
                                HorizontalOptions="Center"
                                Spacing="10"
                                Padding="6">

                                <Grid HeightRequest="200"
                                      WidthRequest="40"
                                      VerticalOptions="End">

                                    <BoxView Color="{StaticResource AccentColor}"
                                             WidthRequest="26"
                                             HorizontalOptions="Center"
                                             VerticalOptions="End"
                                             HeightRequest="{Binding Minutes}"
                                             CornerRadius="8" />
                                </Grid>

                                <Label Text="{Binding Day}"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource TextDark}"
                                       HorizontalOptions="Center" />

                                <Label Text="{Binding Minutes, StringFormat='{}{0} min'}"
                                       FontSize="13"
                                       TextColor="{StaticResource TextLight}"
                                       HorizontalOptions="Center" />

                            </VerticalStackLayout>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>

                </CollectionView>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
