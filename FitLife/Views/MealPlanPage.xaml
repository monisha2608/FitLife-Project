<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="FitLife.Views.MealPlanPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:FitLife.ViewModels"
    xmlns:models="clr-namespace:FitLife.Models"
    x:DataType="vm:MealsViewModel"
    Title="Meal Plan"
    Padding="16">

    <!-- Header style lives in Resources (not in visual tree) -->
    <ContentPage.Resources>
        <!-- Make headers bright and visible on dark background -->
        <Style x:Key="MealHeader" TargetType="Label" BasedOn="{StaticResource H2}">
            <Setter Property="TextColor" Value="{StaticResource PrimaryColor}" />
            <Setter Property="Margin" Value="0,10,0,4" />
            <Setter Property="FontAttributes" Value="Bold" />
        </Style>

        <!-- Row card style -->
        <Style x:Key="MealRowCard" TargetType="Frame" BasedOn="{StaticResource Card}">
            <Setter Property="Padding" Value="12" />
            <Setter Property="Margin" Value="0,6,0,0" />
        </Style>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Spacing="14">

            <!-- Summary -->
            <Frame Style="{StaticResource Card}">
                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                    <VerticalStackLayout Spacing="6">
                        <Label Text="Total Calories Today" Style="{StaticResource Caption}" />
                        <Label Text="{Binding TotalCalories}" FontSize="22" FontAttributes="Bold" TextColor="{StaticResource PrimaryColor}" />
                    </VerticalStackLayout>
                    <Button Text="Edit Plan" Style="{StaticResource OutlineButton}" />
                </Grid>
            </Frame>

            <!-- ===== Breakfast ===== -->
            <Label Text="Breakfast" Style="{StaticResource MealHeader}" />
            <BoxView HeightRequest="1" Color="{StaticResource BorderColor}" Opacity="0.6" />
            <CollectionView ItemsSource="{Binding Breakfast}" SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Meal">
                        <Frame Style="{StaticResource MealRowCard}">
                            <Grid ColumnDefinitions="64,*,Auto" ColumnSpacing="12">
                                <Image Source="{Binding Image}" WidthRequest="64" HeightRequest="64" Aspect="AspectFill" />
                                <VerticalStackLayout Grid.Column="1" Spacing="2">
                                    <Label Text="{Binding Name}" FontAttributes="Bold" TextColor="{StaticResource TextDark}" />
                                    <Label Text="{Binding Notes}" Style="{StaticResource Body}" />
                                </VerticalStackLayout>
                                <Label Grid.Column="2"
                       Text="{Binding Calories, StringFormat='{}{0} cal'}"
                       Style="{StaticResource Caption}"
                       VerticalOptions="Center" />
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- ===== Lunch ===== -->
            <Label Text="Lunch" Style="{StaticResource MealHeader}" />
            <BoxView HeightRequest="1" Color="{StaticResource BorderColor}" Opacity="0.6" />
            <CollectionView ItemsSource="{Binding Lunch}" SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Meal">
                        <Frame Style="{StaticResource MealRowCard}">
                            <Grid ColumnDefinitions="64,*,Auto" ColumnSpacing="12">
                                <Image Source="{Binding Image}" WidthRequest="64" HeightRequest="64" Aspect="AspectFill" />
                                <VerticalStackLayout Grid.Column="1" Spacing="2">
                                    <Label Text="{Binding Name}" FontAttributes="Bold" TextColor="{StaticResource TextDark}" />
                                    <Label Text="{Binding Notes}" Style="{StaticResource Body}" />
                                </VerticalStackLayout>
                                <Label Grid.Column="2"
                       Text="{Binding Calories, StringFormat='{}{0} cal'}"
                       Style="{StaticResource Caption}"
                       VerticalOptions="Center" />
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- ===== Dinner ===== -->
            <Label Text="Dinner" Style="{StaticResource MealHeader}" />
            <BoxView HeightRequest="1" Color="{StaticResource BorderColor}" Opacity="0.6" />
            <CollectionView ItemsSource="{Binding Dinner}" SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Meal">
                        <Frame Style="{StaticResource MealRowCard}">
                            <Grid ColumnDefinitions="64,*,Auto" ColumnSpacing="12">
                                <Image Source="{Binding Image}" WidthRequest="64" HeightRequest="64" Aspect="AspectFill" />
                                <VerticalStackLayout Grid.Column="1" Spacing="2">
                                    <Label Text="{Binding Name}" FontAttributes="Bold" TextColor="{StaticResource TextDark}" />
                                    <Label Text="{Binding Notes}" Style="{StaticResource Body}" />
                                </VerticalStackLayout>
                                <Label Grid.Column="2"
                       Text="{Binding Calories, StringFormat='{}{0} cal'}"
                       Style="{StaticResource Caption}"
                       VerticalOptions="Center" />
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- ===== Snack ===== -->
            <Label Text="Snack" Style="{StaticResource MealHeader}" />
            <BoxView HeightRequest="1" Color="{StaticResource BorderColor}" Opacity="0.6" />
            <CollectionView ItemsSource="{Binding Snack}" SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Meal">
                        <Frame Style="{StaticResource MealRowCard}">
                            <Grid ColumnDefinitions="64,*,Auto" ColumnSpacing="12">
                                <Image Source="{Binding Image}" WidthRequest="64" HeightRequest="64" Aspect="AspectFill" />
                                <VerticalStackLayout Grid.Column="1" Spacing="2">
                                    <Label Text="{Binding Name}" FontAttributes="Bold" TextColor="{StaticResource TextDark}" />
                                    <Label Text="{Binding Notes}" Style="{StaticResource Body}" />
                                </VerticalStackLayout>
                                <Label Grid.Column="2"
                       Text="{Binding Calories, StringFormat='{}{0} cal'}"
                       Style="{StaticResource Caption}"
                       VerticalOptions="Center" />
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <Button Text="Add Meal" Command="{Binding AddMealCmd}" Style="{StaticResource PrimaryButton}" />

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
